# Name Servers

we go throw the DNS server installation:

suppose you are the owner of `www.example.com` we have switch and in the sub network we have 2 DNS servers and a client (10.0.1.12).

we want both of the DNS server accessible publicly from the internet by `ns1.example.com` (10.0.1.10) and `ns1.example.com` (10.0.1.11).

the IP of the gateway is 10.0.0.2

## configuration

- primary host: configure primary host to only permit queries from the secondary host

- secondary host: configure secondary host to only permit queries from the internal subnet 10.0.1.0/24

- client: uses secondary host for its DNS queries

## setup

- on dns server 1 (10.0.1.10) as primary host

  ``` bash
  yum install -y bind bind-utils NetworkManager bash-completion
  source /etc/profile # apply completion

  cat /etc/named.conf # configuration of DNS server
  cat /usr/share/doc/bind-9.11.4/sample/etc/named.conf # example bind

  vim /etc/named.conf
  named-checkconf /etc/named.conf # check syntax of the config file

  vim /var/named/forward.example.com
  named-checkzone example.com /var/named/forward.example.com

  vim /var/named/reverse.example.com
  named-checkzone example.com /var/named/reverse.example.com

  systemctl enable named && systemctl start named

  dig example.com
  dig @localhost example.com

  firewall-cmd --permanent --add-service=dns
  firewall-cmd --reload
  ```

  ``` named.conf
  # listen on port 53 { 127.0.0.1; 10.0.1.11; }
  allow qyery { localhost; 10.0.1.0/24; }
  recursion no;
  zone "example.com" IN {
      type slave;
      file "/slaves/example.com.fwd";
      masters { 10.0.1.10; };
  };
  zone "1.0.10.in-addr.arpa" IN {
      type slave;
      file "/slaves/example.com.rev";
      masters { 10.0.1.10; };
  };
  ```

- on dns server 2 (10.0.1.11)

  ``` bash
  yum install -y bind bind-utils NetworkManager bash-completion
  source /etc/profile # apply completion

  # use named.conf from below
  vim /etc/named.conf

  named-checkconf /etc/named.conf # check syntax of the config file
  ```

  ``` named.conf
  # listen on port 53 { 127.0.0.1; 10.0.1.11; }
  allow qyery { localhost; 10.0.1.0/24; }
  recursion no;
  zone "example.com" IN {
      type slave;
      file "/slaves/example.com.fwd";
      masters { 10.0.1.10; };
  };
  zone "1.0.10.in-addr.arpa" IN {
      type slave;
      file "/slaves/example.com.rev";
      masters { 10.0.1.10; };
  };
  ```

- on the client

  ``` bash
  dig @10.0.1.10 server1.example.com
  dig @10.0.1.11 server1.example.com

  cat /etc/resolv.conf
  # nameserver 10.0.0.2
  # search ec2.internal

  # enable NetworkManager if it's not enabled
  systemctl enable NetworkManager && systemctl start NetworkManager

  nmcli con mod System\ eth0 ipv4.method manual ipv4.addresse 10.0.1.12/24 ipv4.gateway 10.0.1.1
  systemctl restart network

  nmcli d show

  cat /etc/resolv.conf
  # at this point we don't have any DNS server up

  nmcli con modify System\ eth0 ipv4.dns 10.0.1.10 ipv4.dns-search example.com
  systemctl restart network

  ping server1.example.com
  ping server1
  ```
